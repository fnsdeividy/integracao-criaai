<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Teste Create Document - Cookies</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
      background: #f5f5f5;
    }

    .container {
      background: white;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    button {
      background: #007bff;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      margin: 10px 0;
    }

    button:hover {
      background: #0056b3;
    }

    .log {
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 4px;
      padding: 15px;
      margin-top: 20px;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      max-height: 500px;
      overflow-y: auto;
      white-space: pre-wrap;
    }

    .success {
      color: #28a745;
      font-weight: bold;
    }

    .error {
      color: #dc3545;
      font-weight: bold;
    }

    .info {
      color: #007bff;
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>üß™ Teste Create Document - Verifica√ß√£o de Cookies</h1>
    <p>Este teste verifica se os cookies est√£o sendo setados corretamente pela API.</p>

    <button onclick="runTest()">üöÄ Executar Teste</button>
    <button onclick="checkCookies()">üç™ Verificar Cookies</button>
    <button onclick="clearLog()">üóëÔ∏è Limpar Log</button>

    <div id="log" class="log"></div>
  </div>

  <script>
    const API_URL = 'https://api-whitelabel-dev.criaai.com';
    const API_KEY = 'EQUFUr6ipU2lX2WcpMBoc3Lk7mdDYNMH2rcq1jgE';
    const TOKEN = 'eyJhbGciOiJSUzI1NiIsImtpZCI6IjU0NTEzMjA5OWFkNmJmNjEzODJiNmI0Y2RlOWEyZGZlZDhjYjMwZjAiLCJ0eXAiOiJKV1QifQ.eyJpc3MiOiJodHRwczovL3NlY3VyZXRva2VuLmdvb2dsZS5jb20vY3JpYWFpLTI1Y2RlIiwiYXVkIjoiY3JpYWFpLTI1Y2RlIiwiYXV0aF90aW1lIjoxNzYyMjcyNDkwLCJ1c2VyX2lkIjoid1VKSnQxbm1yZk0zSldjZkpGSTVUaVpQQ2V3MSIsInN1YiI6IndVSkp0MW5tcmZNM0pXY2ZKRkk1VGlaUENldzEiLCJpYXQiOjE3NjIyNzI0OTAsImV4cCI6MTc2MjI3NjA5MCwiZW1haWwiOiJmbnNkZWl2aWR5QGdtYWlsLmNvbSIsImVtYWlsX3ZlcmlmaWVkIjp0cnVlLCJmaXJlYmFzZSI6eyJpZGVudGl0aWVzIjp7ImVtYWlsIjpbImZuc2RlaXZpZHlAZ21haWwuY29tIl19LCJzaWduX2luX3Byb3ZpZGVyIjoicGFzc3dvcmQifX0.AK3lBYEp_I2XesTgnbclNeTCcgmKD-omi0cnLfjQK8Av_PR2soTAEUxodyLf6t5QUr3kI5_cYdaQhfNkBif23z5rhZcYgairbRVJ0EpDjm2EhFaPHfpbqhLuVgWYsWaaGbkpaIyx-EFANxsYz0oWWICGBCqKurg3GuSGoQ473vQiDMQabfv3pcZiAfqCtBkkyVJIFjz0t_NrImPrhUO-M8qu47CfhG4NgERJebbDsh_f2TwVfUMZ74N9atUDuNB8Qoh0t8vCKRV1-QIgswvYgGX9u0tipCfgZG5yMGe1utC1nVGONSHA697N0AAzsC55WnPl45LJPFufrKfG-19Iow';

    function log(message, type = 'info') {
      const logDiv = document.getElementById('log');
      const timestamp = new Date().toLocaleTimeString();
      const className = type === 'success' ? 'success' : type === 'error' ? 'error' : 'info';
      logDiv.innerHTML += `<span class="${className}">[${timestamp}] ${message}</span>\n`;
      logDiv.scrollTop = logDiv.scrollHeight;
    }

    function clearLog() {
      document.getElementById('log').innerHTML = '';
    }

    function getCookie(name) {
      const value = `; ${document.cookie}`;
      const parts = value.split(`; ${name}=`);
      if (parts.length === 2) return parts.pop().split(';').shift();
      return null;
    }

    function checkCookies() {
      log('üç™ Verificando cookies atuais...', 'info');
      log(`document.cookie: ${document.cookie || '(nenhum cookie)'}`, 'info');

      const authToken = getCookie('authToken');
      const authRefreshToken = getCookie('authRefreshToken');
      const documentId = getCookie('documentId');

      log(`\nauthToken: ${authToken ? '‚úÖ ' + authToken.substring(0, 50) + '...' : '‚ùå N√ÉO SETADO'}`, authToken ? 'success' : 'error');
      log(`authRefreshToken: ${authRefreshToken ? '‚úÖ ' + authRefreshToken.substring(0, 50) + '...' : '‚ùå N√ÉO SETADO'}`, authRefreshToken ? 'success' : 'error');
      log(`documentId: ${documentId || '‚ùå N√ÉO SETADO'}`, documentId ? 'success' : 'error');
    }

    async function runTest() {
      clearLog();
      log('üöÄ Iniciando teste de createDocument...', 'info');
      log(`üìç URL: ${API_URL}/documents/create-document`, 'info');

      // Verificar cookies antes
      log('\nüìã Cookies ANTES da requisi√ß√£o:', 'info');
      log(`document.cookie: ${document.cookie || '(nenhum cookie)'}`, 'info');

      try {
        const response = await fetch(`${API_URL}/documents/create-document`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'x-api-key': API_KEY,
            'Authorization': `Bearer ${TOKEN}`,
            'origin': window.location.origin
          },
          credentials: 'include', // ‚Üê CRUCIAL: Permite receber cookies
          body: JSON.stringify({
            linkCallback: 'https://yoursite.com/callback'
          })
        });

        log(`\n‚úÖ Status da resposta: ${response.status}`, response.ok ? 'success' : 'error');

        // Verificar Set-Cookie headers
        const setCookieHeaders = [];
        response.headers.forEach((value, key) => {
          if (key.toLowerCase().includes('set-cookie')) {
            setCookieHeaders.push(value);
          }
        });

        if (setCookieHeaders.length > 0) {
          log(`\nüì¶ Set-Cookie headers recebidos (${setCookieHeaders.length}):`, 'info');
          setCookieHeaders.forEach((header, index) => {
            log(`  Cookie ${index + 1}: ${header.substring(0, 100)}...`, 'info');
          });
        } else {
          log('\n‚ö†Ô∏è Nenhum Set-Cookie header encontrado na resposta!', 'error');
        }

        const data = await response.json();
        log(`\nüìÑ Response body: ${JSON.stringify(data, null, 2)}`, 'info');

        // Aguardar um pouco para os cookies serem processados
        await new Promise(resolve => setTimeout(resolve, 500));

        // Verificar cookies depois
        log('\nüìã Cookies DEPOIS da requisi√ß√£o:', 'info');
        log(`document.cookie: ${document.cookie || '(nenhum cookie)'}`, 'info');

        const authToken = getCookie('authToken');
        const authRefreshToken = getCookie('authRefreshToken');
        const documentId = getCookie('documentId');

        log('\nüç™ Cookies espec√≠ficos:', 'info');
        log(`authToken: ${authToken ? '‚úÖ ' + authToken.substring(0, 50) + '...' : '‚ùå N√ÉO SETADO'}`, authToken ? 'success' : 'error');
        log(`authRefreshToken: ${authRefreshToken ? '‚úÖ ' + authRefreshToken.substring(0, 50) + '...' : '‚ùå N√ÉO SETADO'}`, authRefreshToken ? 'success' : 'error');
        log(`documentId: ${documentId || '‚ùå N√ÉO SETADO'}`, documentId ? 'success' : 'error');

        if (authToken && authRefreshToken && documentId) {
          log('\n‚úÖ SUCESSO! Todos os cookies foram setados!', 'success');
        } else {
          log('\n‚ùå ERRO! Alguns cookies n√£o foram setados.', 'error');
          log('\nüí° Dicas:', 'info');
          log('  1. Verifique no DevTools > Application > Cookies', 'info');
          log('  2. Verifique se o Domain do cookie est√° correto (.criaai.com)', 'info');
          log('  3. Verifique se est√° usando HTTPS', 'info');
          log('  4. Verifique os logs do CloudWatch', 'info');
        }

      } catch (error) {
        log(`\n‚ùå ERRO na requisi√ß√£o: ${error.message}`, 'error');
        console.error('Erro completo:', error);
      }
    }

    // Verificar cookies ao carregar a p√°gina
    window.addEventListener('load', () => {
      log('üìÑ P√°gina carregada. Use os bot√µes para testar.', 'info');
      checkCookies();
    });
  </script>
</body>

</html>